<?xml version="1.0" encoding="ISO-8859-1"?>
<!--
      Ant build file for the database component of ABRAID-MP.
      Copyright (c) 2014 University of Oxford
-->
<project name="Database" basedir="." default="create.test.database">
    <description>Creates the ABRAID-MP database.</description>

    <!-- To customise the database properties, copy file database.properties.example to database.properties and modify it -->
    <!-- If database.properties does not exist, this uses database.properties.example -->
    <property file="database.properties" />
    <property file="database.properties.example" />

    <!-- Creates the database containing test data -->
    <target name="create.test.database" depends="create.database, create.test.data" />

    <!-- Creates the database -->
    <!-- Assumes that the superuser password is either empty or is in file ~/.pgpass (this is %APPDATA%\postgresql\pgpass.conf on Windows) -->
    <target name="create.database">
        <exec executable="psql" failonerror="true">
            <arg value="-U" />
            <arg value="${superuser.name}" />
            <arg value="-q" />
            <arg value="-w" />
            <arg value="-v" />
            <arg value="ON_ERROR_STOP=ON" />
            <arg value="-v" />
            <arg value="database_name=${database.name}" />
            <arg value="-v" />
            <arg value="application_username=${application.username}" />
            <arg value="-v" />
            <arg value="application_password=${application.password}" />
            <arg value="-f" />
            <arg value="create_database.sql" />
        </exec>
    </target>

    <!-- Adds test data to an existing database -->
    <!-- Assumes that the superuser password is either empty or is in file ~/.pgpass (this is %APPDATA%\postgresql\pgpass.conf on Windows) -->
    <target name="create.test.data">
        <exec executable="psql" failonerror="true" dir="testdata">
            <arg value="-U" />
            <arg value="${superuser.name}" />
            <arg value="-q" />
            <arg value="-w" />
            <arg value="-v" />
            <arg value="ON_ERROR_STOP=ON" />
            <arg value="-f" />
            <arg value="testdata.sql" />
            <arg value="${database.name}" />
        </exec>
    </target>
</project>
